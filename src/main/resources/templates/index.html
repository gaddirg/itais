<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

	<head th:replace="layouts/fragments :: head-bootstrap-core"></head>
	<head th:replace="layouts/fragments :: head-custom-css"></head>
	<div th:replace="layouts/fragments :: script-chart"></div>
<body>

	<div th:replace="layouts/navigation:: nav-top"></div>
	
	<div id="wrapper">
	
		<div th:replace="layouts/navigation:: nav-side"></div>
	
        <div id="page-content-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
	        			<!-- Page Content -->


                        <h2 class="page-header">Home</h2>
			            <div class="col-md-8">
			            <row>
			            
			                <div class="panel panel-default">
			                    <div class="panel-heading">
			                        <h4>Inventories that will be expiring in 60 days</h4>
			                    </div>
			                    <div class="panel-body">
									  <table class="table table-striped">
									    <thead>
									      <tr>
									      	<th>Office Branch</th>
									        <th>Name</th>
									        <th>Serial Number</th>
									        <th>Warranty Expiration</th>
									      </tr>
									    </thead>
									    <tbody>
									    <th:block th:each="iate : ${invAboutToExpire}">
									      <tr>
									      	<td th:text="${iate.office.name}" />
									        <td th:text="${iate.name}" />
									        <td th:text="${iate.serialNumber}" />
									        <td th:text="${iate.warrantyExpirationDate}" />
									      </tr>
									    </th:block>
									    </tbody>
									  </table>
			                    </div>
			                    <div class="panel-body">
									  <table class="table table-striped">
									    <thead>
									      <tr>
									      	<th>Office Branch</th>
									        <th>Name</th>
									        <th>Serial Number</th>
									        <th>Warranty Expiration</th>
									      </tr>
									    </thead>
									    <tbody>
									    <th:block th:each="ie : ${invExpired}">
									      <tr>
									      	<td th:text="${ie.office.name}" />
									        <td th:text="${ie.name}" />
									        <td th:text="${ie.serialNumber}" />
									        <td th:text="${ie.warrantyExpirationDate}" />
									      </tr>
									    </th:block>
									    </tbody>
									  </table>
			                    </div>
			                </div>
			                </row>
			                
			                

			               	<row>
				                <div class="panel panel-default">
				                    <div class="panel-heading">
				                        <h4>Inventory per Machine Type</h4>
				                    </div>
				                    <div class="panel-body">
 										<canvas id="officeChart"></canvas>
				                    </div>
				                </div>
			                </row>
		    
			            </div>
			            
			            <div class="col-md-4">
			            	<row>
			                <div class="panel panel-default">
			                    <div class="panel-heading">
			                        <h4>Inventory per Office Branch</h4>
			                    </div>
			                    <div class="panel-body">
									  <table class="table table-striped">
									    <thead>
									      <tr>
									        <th>Branch Offices</th>
									        <th>Inventory Count</th>
									      </tr>
									    </thead>
									    <tbody>
									    <th:block th:each="office : ${offices}">
									      <tr>
									        <td th:text="${office.name}" />
									        <td th:text="${office.inventories.size()}" />
									      </tr>
									    </th:block>
									    </tbody>
									  </table>
			                    </div>
			                </div>
			                </row>
			                
			            	<row>
			                <div class="panel panel-default">
			                    <div class="panel-heading">
			                        <h4>Inventory per Machine Type</h4>
			                    </div>
			                    <div class="panel-body">
			
									  <table class="table table-striped">
									    <thead>
									      <tr>
									        <th>Machine Type</th>
									        <th>Inventory Count</th>
									      </tr>
									    </thead>
									    <tbody>
									    <th:block th:each="at : ${assetTypes}">
									      <tr>
									        <td th:text="${at.type}" />
									        <td th:text="${at.inventories.size()}" />
									      </tr>
									    </th:block>
									    </tbody>
									  </table>
			                    </div>
			                </div>
			                </row>
		                
			            </div>                      


        				<!-- /#page-content-wrapper -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /#wrapper -->
   
	<div th:replace="layouts/fragments :: script-bootstrap-core"></div>
	<div th:replace="layouts/fragments :: script-navbar"></div>

	<script type="text/javascript" th:inline="javascript">

		var officeData = [[${officeJson}]];
	
		var gColor=myFunction("colors",officeData);
		var gLabels=myFunction("labels",officeData);
		var gData=myFunction("data",officeData);
		
		var ctx = document.getElementById("officeChart").getContext('2d');
		var myChart = new Chart(ctx, {
		  type: 'doughnut',
		  options: {
		      responsive: true
		  },
		  data: {
		    labels: gLabels,
		    datasets: [{
		      backgroundColor: gColor,
		      data: gData
		    }]
		  }
		});
		
		function myFunction(mode, jsonData) {

			var jData = JSON.parse(jsonData);
			
			var labels = [];
			var colors = [];
			var data = [];
			var x;
			for (x in jData) {
				labels.push(jData[x].name);
				colors.push(jData[x].color);
				data.push(jData[x].invCount);
			}
			
			if(mode=="colors") {
				return colors;
			} else if (mode=="labels"){
				return labels;
			} else {
				return data;
			}
		}

</script>


</body>
</html>